@using WebScraper;
@using solarmhc.Models;
@using solarmhc.Models.Services;
@using solarmhc.Web.Pages.Components
@inject LiveDataService liveDataService;
@page "/solaredge/dashboard"

<MudGrid>
    @* Current Power Widget *@
    <MudItem>
        <CurrentPower DashboardName="@DashboardName" />
    </MudItem>
    <MudItem>
        <CO2Savings SavedEmissions="@liveDataService.GetSavedEmissions(DashboardName)" SavedTrees="@liveDataService.GetSavedTrees(DashboardName)" />
    </MudItem>
    <MudItem>
        <Weather />
    </MudItem>
</MudGrid>

@code {
    public string DashboardName { get; set; } = Constants.Names.SolarEdge;

    protected override void OnInitialized()
    {
        liveDataService.OnChange += UpdateLiveData;
    }

    private void UpdateLiveData()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        liveDataService.OnChange -= UpdateLiveData;
    }
}